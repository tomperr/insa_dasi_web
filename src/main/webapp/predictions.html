<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>        
        <div class="container" id="current-consultation-container">
            
        </div>
        
        <script>
        
        function e(tag, parent, id, classs, value) {
            let element = document.createElement(tag);
            element.className = classs;
            element.id = id;
            element.innerHTML = value;
            parent.appendChild(element);
            return element;
        }
        
        // ELEMENTS CREATION
        
        let current_consultation_container = document.querySelector("#current-consultation-container");
        let selecteurs_predictions = e("div", current_consultation_container, "selecteurs_predictions", "row", "");
        
        let amour_col = e("div", selecteurs_predictions, "", "col-xs-12 col-md-4 px-3 text-center", "");
        let amour_col_container = e("div", amour_col, "", "border py-3", "");
        let amour_h4 = e("h4", amour_col_container, "", "", "Amour");
        let amour_range = e("input", amour_col_container, "amour-range", "form-range", "");
        amour_range.type = 'range';
        amour_range.min = 1;
        amour_range.max = 4;
        amour_range.step = 1;
        amour_range.value = 1;
        let amour_value = e("p", amour_col_container, "amour-value", "", "1");
        
        let sante_col = e("div", selecteurs_predictions, "", "col-xs-12 col-md-4 px-3 text-center", "");
        let sante_col_container = e("div", sante_col, "", "border py-3", "");
        let sante_h4 = e("h4", sante_col_container, "", "", "Santé");
        let sante_range = e("input", sante_col_container, "santer-range", "form-range", "");
        sante_range.type = 'range';
        sante_range.min = 1;
        sante_range.max = 4;
        sante_range.step = 1;
        sante_range.value = 1;
        let sante_value = e("p", sante_col_container, "sante-value", "", "1");
        
        let travail_col = e("div", selecteurs_predictions, "", "col-xs-12 col-md-4 px-3 text-center", "");
        let travail_col_container = e("div", travail_col, "", "border py-3", "");
        let travail_h4 = e("h4", travail_col_container, "", "", "Travail");
        let travail_range = e("input", travail_col_container, "travail-range", "form-range", "");
        travail_range.type = 'range';
        travail_range.min = 1;
        travail_range.max = 4;
        travail_range.step = 1;
        travail_range.value = 1;
        let travail_value = e("p", travail_col_container, "travail-value", "", "1");
        
        let bouton_generer_container = e("div", current_consultation_container, "", "m-auto text-center py-4", "");
        let bouton_generer = e("button", bouton_generer_container, "generer-bouton", "btn btn-primary", "Générer");
        
        let textes_predictions = e("div", current_consultation_container, "textes-predictions", "row", "");
        let prediction_amour = e("div", textes_predictions, "prediction-amour", "col-xs-12 col-md-4 px-3 text-center", "");
        let prediction_sante = e("div", textes_predictions, "textes-predictions", "col-xs-12 col-md-4 px-3 text-center", "");
        let prediction_travail = e("div", textes_predictions, "textes-predictions", "col-xs-12 col-md-4 px-3 text-center", "");

        let div_input_container = e("div", current_consultation_container, "", "", "");
        let form_group = e("div", div_input_container, "", "form-group", "");
        let label_commentaire = e("label", form_group, "", "", "Commentaire");
        label_commentaire.for = "inputCommentaire";
        let commentaire_input = e("textarea", form_group, "inputCommentaire", "form-control", "");
        let submit_container = e("div", div_input_container, "", "text-right", "");
        let bouton_terminer = e("button", submit_container, "terminerConsultation", "btn btn-primary", "Terminer la consultation");

        // EVENTS
        
        amour_range.addEventListener("change", function() {
            amour_value.innerHTML = this.value;
        });
        
        sante_range.addEventListener("change", function() {
            sante_value.innerHTML = this.value;
        });
        
        travail_range.addEventListener("change", function() {
            travail_value.innerHTML = this.value;
        });
                        
        bouton_generer.addEventListener("click", function() {
            
            // Appel AJAX
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'genererPredictions',
                    amour: amour_range.value,
                    sante: sante_range.value,
                    travail: travail_range.value
                },
                dataType: 'json'
            })
            .done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                console.log('Response',response); // LOG dans Console Javascript    
                
                // remove old prediction
                prediction_amour.innerHTML = "";
                prediction_sante.innerHTML = "";
                prediction_travail.innerHTML = "";
                
                let container_amour = e("div", prediction_amour, "", "border p-3", "");
                e("p", container_amour, "", "", response.amour);
                
                let container_sante = e("div", prediction_sante, "", "border p-3", "");
                e("p", container_sante, "", "", response.sante);
                
                let container_travail = e("div", prediction_travail, "", "border p-3", "");
                e("p", container_travail, "", "", response.travail);

            })
            .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                console.log('Error',error); // LOG dans Console Javascript
                alert("Erreur lors de l'appel AJAX");
            })
            .always( function () { // Fonction toujours appelée

            });
        });
                
        bouton_terminer.addEventListener('click', function() {
            
            // Appel AJAX
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'terminerConsultation',
                    commentaire: commentaire_input.value
                },
                dataType: 'json'
            })
            .done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                console.log('Response',response); // LOG dans Console Javascript
                if (response.finished == "true") {
                    window.location = "./espace-employe.html";
                } else {
                    alert("Erreur lors de terminerConsultation");
                }
            })
            .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                console.log('Error',error); // LOG dans Console Javascript
                alert("Erreur lors de l'appel AJAX");
            })
            .always( function () { // Fonction toujours appelée

            });
        
        });
        
    
        </script>
        
    </body>
</html>
